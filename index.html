<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Focus Garden V10</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Noto+Serif+JP:wght@500&display=swap');

        :root {
            --bg-color: #FDFAE5;      
            --primary-color: #A8D8EA; 
            --accent-color: #FFB7B2;
            --text-color: #635E5B;    
            --card-bg: rgba(255, 255, 255, 0.98);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; display: flex; justify-content: center; align-items: center;
            min-height: 100vh; flex-direction: column; overflow: hidden;
            transition: background 1s ease;
        }

        .screen {
            background: var(--card-bg); padding: 1.5rem; border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center;
            max-width: 600px; width: 90%; position: relative; z-index: 10;
            border: 4px solid #fff; transition: opacity 0.5s;
        }
        .hidden { display: none !important; }

        /* --- UI ELEMENTS --- */
        .btn {
            border: none; padding: 10px 20px; border-radius: 50px;
            font-size: 1rem; cursor: pointer; font-weight: 700;
            transition: all 0.2s; margin: 5px; color: white;
            font-family: 'Quicksand', sans-serif; box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
        .btn-primary { background-color: var(--accent-color); }
        .btn-outline { background: transparent; border: 2px solid var(--primary-color); color: var(--text-color); box-shadow: none; }
        .btn-home { position: absolute; top: 15px; left: 15px; background: #fff; color: #555; border: 2px solid #eee; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 20; font-size: 1.2rem;}

        .top-bar { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; z-index: 20; }
        .btn-icon { padding: 8px 12px; font-size: 1.2rem; border-radius: 15px; background: rgba(255,255,255,0.8); color: #555; border: none; cursor: pointer;}

        /* --- SAVE SLOTS (PERFILES) --- */
        .slot-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .save-slot {
            width: 80px; height: 80px; border-radius: 15px; border: 3px solid #eee;
            background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .save-slot:hover { transform: translateY(-5px); border-color: var(--primary-color); }
        .save-slot.active { border-color: var(--accent-color); background: #FFF0F0; }
        .slot-name { font-size: 0.7rem; margin-top: 5px; color: #888; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 70px;}

        /* --- SETUP --- */
        .pet-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .pet-card { border: 2px solid #eee; border-radius: 15px; padding: 5px; cursor: pointer; transition: transform 0.2s; background: #fff; }
        .pet-card.selected { border-color: var(--accent-color); background-color: #FFF0F0; transform: scale(1.1); }
        .pet-icon-select { font-size: 2rem; display: block; }
        
        .color-options { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; border: 3px solid #eee; cursor: pointer; transition: transform 0.2s; }
        .color-dot.active { border-color: var(--accent-color); transform: scale(1.2); }

        input[type="text"], select { width: 100%; padding: 10px; border-radius: 15px; border: 2px solid var(--primary-color); font-size: 1rem; outline: none; box-sizing: border-box; background: #fff; margin-bottom: 10px;}

        /* --- JARD√çN --- */
        .garden-scene {
            height: 250px; position: relative;
            background: linear-gradient(to top, #81d4fa 0%, #b3e5fc 100%);
            border-radius: 20px; margin-bottom: 20px; overflow: hidden;
            transition: background 1s ease; border: 4px solid #fff;
        }
        
        /* Elementos Ambiente */
        .celestial-body { font-size: 4rem; position: absolute; top: 20px; right: 20px; transition: all 2s ease; z-index: 2; }
        .clouds-layer, .stars-layer, .rain-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        .cloud { position: absolute; font-size: 3rem; opacity: 0.8; animation: floatCloud 30s infinite linear; }
        @keyframes floatCloud { from { transform: translateX(-50px); } to { transform: translateX(450px); } }
        
        .star { position: absolute; color: #FFF; animation: twinkle 3s infinite ease-in-out; font-size: 1rem; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; transform: scale(1.2); } }

        .rain-layer {
            background-image: repeating-linear-gradient(170deg, transparent, transparent 40px, rgba(255, 255, 255, 0.4) 40px, rgba(255, 255, 255, 0.4) 42px);
            opacity: 0; z-index: 5; background-size: 100% 200%;
            animation: rainFall 0.7s linear infinite; transition: opacity 2s;
        }
        @keyframes rainFall { from {background-position: 0 0;} to {background-position: 0 100%;} }

        #tree-display { font-size: 6rem; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); transition: all 0.5s; z-index: 3; }

        /* --- MASCOTA ANIMADA --- */
        #pet-container {
            position: absolute; bottom: 10px; left: 20%; cursor: pointer; z-index: 4;
            /* Transition se controla por JS para variar velocidad */
        }
        #pet-sprite { font-size: 3.5rem; display: block; transition: transform 0.2s; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); }

        .emote-bubble {
            position: absolute; top: -45px; right: -15px; background: white;
            padding: 5px 10px; border-radius: 15px; border: 2px solid var(--accent-color);
            font-size: 1.5rem; opacity: 0; transform: translateY(10px); transition: all 0.3s; z-index: 10;
        }
        .emote-visible { opacity: 1; transform: translateY(0); }

        /* ANIMACIONES CSS */
        @keyframes jumpAnim { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        @keyframes spinAnim { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes doubleJumpAnim { 0% { transform: translateY(0); } 25% { transform: translateY(-15px); } 50% { transform: translateY(0); } 75% { transform: translateY(-15px); } 100% { transform: translateY(0); } }
        
        .jumping { animation: jumpAnim 0.5s ease; }
        .spinning { animation: spinAnim 0.6s ease; }
        .double-jumping { animation: doubleJumpAnim 0.6s ease; }
        .face-flip { transform: scaleX(-1); }

        .timer-display { font-size: 4rem; font-weight: 700; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); margin: 5px 0; }

        /* --- OVERLAYS --- */
        .overlay-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.98); border-radius: 30px; z-index: 100; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; }
        
        .kanban-board { display: flex; gap: 10px; overflow-x: auto; height: 100%; margin-top: 10px; }
        .kanban-col { flex: 1; min-width: 140px; background: #f9f9f9; border-radius: 15px; padding: 10px; display: flex; flex-direction: column; border: 2px solid #eee; }
        .task-card { background: white; padding: 10px; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 0.85rem; cursor: pointer; border-left: 4px solid var(--primary-color); }

        .collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; overflow-y: auto; flex: 1; margin-top: 10px; }
        .word-card { 
            background: #fff; border-radius: 10px; padding: 10px; text-align: center; 
            border-left: 4px solid #ddd; cursor: pointer; transition: all 0.3s;
        }
        .word-card:hover { transform: translateY(-5px); border-left-color: var(--accent-color); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* DEV TOOLS */
        #dev-panel { position: fixed; bottom: 5px; left: 5px; background: rgba(0,0,0,0.8); padding: 5px; border-radius: 5px; z-index: 2000; display: flex; gap: 5px; opacity: 0.3; transition: opacity 0.3s; }
        #dev-panel:hover { opacity: 1; }
        .dev-btn { background: #333; color: #fff; border: none; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; }

    </style>
</head>
<body>

    <div id="dev-panel">
        <button class="dev-btn" onclick="devAdd(-60)">-1m</button>
        <button class="dev-btn" onclick="devAdd(60)">+1m</button>
        <button class="dev-btn" onclick="devAdd(300)">+5m</button>
    </div>

    <div id="setup-screen" class="screen">
        <h1>üå± Focus Garden</h1>
        <p>Selecciona un perfil:</p>
        
        <div class="slot-container">
            <div class="save-slot" onclick="loadProfile(1)" id="slot-1">
                <span style="font-size:1.5rem">1</span>
                <span class="slot-name" id="name-1">Nuevo</span>
            </div>
            <div class="save-slot" onclick="loadProfile(2)" id="slot-2">
                <span style="font-size:1.5rem">2</span>
                <span class="slot-name" id="name-2">Nuevo</span>
            </div>
            <div class="save-slot" onclick="loadProfile(3)" id="slot-3">
                <span style="font-size:1.5rem">3</span>
                <span class="slot-name" id="name-3">Nuevo</span>
            </div>
        </div>

        <div id="profile-form" class="hidden">
            <div class="pet-grid">
                <div class="pet-card" onclick="selectPet('cat')" id="card-cat"><span class="pet-icon-select">üê±</span></div>
                <div class="pet-card" onclick="selectPet('dog')" id="card-dog"><span class="pet-icon-select">üê∂</span></div>
                <div class="pet-card" onclick="selectPet('fox')" id="card-fox"><span class="pet-icon-select">ü¶ä</span></div>
                <div class="pet-card" onclick="selectPet('bunny')" id="card-bunny"><span class="pet-icon-select">üê∞</span></div>
            </div>

            <div class="color-options">
                <div class="color-dot active" style="background:#FFA726;" onclick="selectColor('none', this)" title="Original"></div>
                <div class="color-dot" style="background:#fff;" onclick="selectColor('brightness(2) grayscale(0.5)', this)" title="Blanco Nieve"></div>
                <div class="color-dot" style="background:#607D8B;" onclick="selectColor('grayscale(100%) brightness(0.8) sepia(0.2) hue-rotate(180deg)', this)" title="Gris Azulado"></div>
                <div class="color-dot" style="background:#5D4037;" onclick="selectColor('sepia(1) brightness(0.6)', this)" title="Chocolate"></div>
                <div class="color-dot" style="background:#F5F5DC;" onclick="selectColor('sepia(0.5) brightness(1.2)', this)" title="Crema"></div>
            </div>

            <input type="text" id="pet-name-input" placeholder="Nombre de la mascota">
            
            <select id="time-select">
                <option value="5">5 Min (Prueba)</option>
                <option value="25" selected>25 Min (Pomodoro)</option>
                <option value="45">45 Min (Profundo)</option>
            </select>

            <button class="btn btn-primary" onclick="startGame()">¬°Jugar!</button>
        </div>
    </div>

    <div id="main-screen" class="screen hidden">
        <button class="btn-home" onclick="goHome()">üè†</button>
        <div class="top-bar">
            <button class="btn btn-icon" onclick="toggleOverlay('collection')">üìñ</button>
            <button class="btn btn-icon" onclick="toggleOverlay('kanban')">üìã</button>
        </div>
        
        <h2 id="header-title" style="color:white; text-shadow:1px 1px 2px rgba(0,0,0,0.3);">Huerto</h2>
        
        <div class="garden-scene" id="garden-bg">
            <div class="celestial-body" id="celestial">‚òÄÔ∏è</div>
            <div class="stars-layer" id="stars" style="opacity:0">
                <div class="star" style="top:20%; left:20%">‚ú®</div><div class="star" style="top:60%; left:80%">‚ú®</div>
            </div>
            <div class="clouds-layer" id="clouds">
                <div class="cloud" style="top:20px;">‚òÅÔ∏è</div>
                <div class="cloud" style="top:50px; left:50%; animation-duration:40s">‚òÅÔ∏è</div>
            </div>
            <div class="rain-layer" id="rain" style="opacity:0"></div>

            <div id="tree-display">üå±</div>
            
            <div id="pet-container" onmouseenter="petInteract()" onmouseleave="petResume()">
                <div class="emote-bubble" id="emote-bubble">‚ù§Ô∏è</div>
                <div id="pet-sprite">üê±</div>
            </div>
        </div>

        <div class="timer-display" id="timer">00:00</div>
        <button class="btn btn-primary" id="btn-action" onclick="toggleTimer()">Pausar</button>
        
        <div id="reward-area" class="hidden">
            <h3>¬°Muy bien!</h3>
            <button class="btn btn-primary" onclick="toggleOverlay('collection')">‚ú® Abrir Bit√°cora</button>
        </div>

        <div id="kanban-overlay" class="overlay-panel hidden">
            <div style="display:flex; justify-content:space-between;"><h3>üìã Tareas</h3><button class="btn btn-outline" onclick="toggleOverlay('kanban')">X</button></div>
            <div style="display:flex; gap:5px; margin:10px 0;"><input type="text" id="task-input" placeholder="Tarea..."><button class="btn btn-primary" onclick="addTask()">+</button></div>
            <div class="kanban-board">
                <div class="kanban-col"><h4>Por Hacer</h4><div id="col-todo"></div></div>
                <div class="kanban-col"><h4>Haciendo</h4><div id="col-doing"></div></div>
                <div class="kanban-col"><h4>Hecho</h4><div id="col-done"></div></div>
            </div>
        </div>

        <div id="collection-overlay" class="overlay-panel hidden">
            <div style="display:flex; justify-content:space-between;"><h3>üìñ Bit√°cora</h3><button class="btn btn-outline" onclick="toggleOverlay('collection')">X</button></div>
            <div class="collection-grid" id="collection-list"></div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const jpWords = [
            {jp:"Komorebi", es:"Luz entre hojas"}, {jp:"Ikigai", es:"Prop√≥sito de vida"},
            {jp:"Wabi-sabi", es:"Belleza imperfecta"}, {jp:"Gaman", es:"Paciencia digna"},
            {jp:"Ukiyo", es:"Mundo flotante"}, {jp:"Yugen", es:"Profundidad misteriosa"}
        ];
        const petEmojis = {'cat':'üê±', 'dog':'üê∂', 'bunny':'üê∞', 'fox':'ü¶ä'};
        const treeStages = ['üå±','üå±','üåø','üåø','üéã','üå≥','üå≥','üå∏','üçé'];
        
        let currentState = {
            currentSlot: 1,
            pet: { type:'cat', name:'', filter:'none' },
            tasks: [],
            words: [] // En esta versi√≥n simplificada desbloqueamos todo para demo
        };
        
        let allProfiles = { 1:null, 2:null, 3:null }; // Almacenamiento
        
        let timer = { total: 25*60, left: 25*60, interval: null };
        let petAI = { interval: null, moving: true };

        // --- INIT ---
        window.onload = function() {
            if(localStorage.getItem('fg_profiles')) allProfiles = JSON.parse(localStorage.getItem('fg_profiles'));
            updateSlotsUI();
        };

        function updateSlotsUI() {
            for(let i=1; i<=3; i++) {
                const p = allProfiles[i];
                document.getElementById('name-'+i).innerText = p ? p.name : "Nuevo";
                // Reset visual selection
                document.getElementById('slot-'+i).classList.remove('active');
            }
        }

        function loadProfile(slot) {
            currentState.currentSlot = slot;
            updateSlotsUI();
            document.getElementById('slot-'+slot).classList.add('active');
            
            const p = allProfiles[slot];
            document.getElementById('profile-form').classList.remove('hidden');
            
            if(p) {
                // Cargar datos existentes
                document.getElementById('pet-name-input').value = p.name;
                selectPet(p.type);
                // Restaurar color es complejo sin UI complex, dejamos default por ahora o el guardado
                currentState.pet = p; 
            } else {
                // Nuevo perfil
                document.getElementById('pet-name-input').value = "";
                currentState.pet = { type:'cat', name:'', filter:'none' };
            }
        }

        // --- SETUP ACTIONS ---
        function selectPet(type) { currentState.pet.type = type; document.querySelectorAll('.pet-card').forEach(e=>e.classList.remove('selected')); document.getElementById('card-'+type).classList.add('selected'); }
        function selectColor(filter, el) { currentState.pet.filter = filter; document.querySelectorAll('.color-dot').forEach(e=>e.classList.remove('active')); el.classList.add('active'); }
        
        function startGame() {
            const name = document.getElementById('pet-name-input').value || "Amigo";
            currentState.pet.name = name;
            
            // Guardar perfil
            allProfiles[currentState.currentSlot] = currentState.pet;
            localStorage.setItem('fg_profiles', JSON.stringify(allProfiles));
            
            // Configurar Timer
            const mins = parseInt(document.getElementById('time-select').value);
            timer.total = mins * 60;
            timer.left = timer.total;

            // UI Switch
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('header-title').innerText = `Huerto de ${name}`;
            
            // Render Mascota
            const sprite = document.getElementById('pet-sprite');
            sprite.innerText = petEmojis[currentState.pet.type];
            sprite.style.filter = currentState.pet.filter;
            
            updateVisuals();
            toggleTimer();
            startPetLife(); // INICIAR IA
            renderCollection();
            updateKanban();
        }

        function goHome() { if(confirm("¬øSalir?")) location.reload(); }

        // --- PET AI (MOVIMIENTO AUT√ìNOMO REAL) ---
        function startPetLife() {
            // Decisi√≥n cada 2.5 segundos
            if(petAI.interval) clearInterval(petAI.interval);
            petAI.interval = setInterval(petDecision, 2500);
        }

        function petDecision() {
            if(!petAI.moving) return; // Si el usuario interact√∫a, no hacer nada

            const pet = document.getElementById('pet-container');
            const sprite = document.getElementById('pet-sprite');
            const roll = Math.random();

            // Limpiar clases
            pet.classList.remove('jumping', 'spinning', 'double-jumping');

            if(roll < 0.4) {
                // 40% CAMINAR O CORRER
                const currentLeft = parseFloat(pet.style.left || 20);
                const newLeft = 10 + Math.random() * 70; // Posici√≥n aleatoria 10-80%
                
                const dist = Math.abs(newLeft - currentLeft);
                const isRun = dist > 30; // Si est√° lejos, corre
                
                pet.style.transition = `left ${isRun ? 1 : 3}s ease-in-out`; // Velocidad din√°mica
                pet.style.left = newLeft + "%";
                
                // Mirar direcci√≥n
                if(newLeft < currentLeft) sprite.classList.add('face-flip');
                else sprite.classList.remove('face-flip');

            } else if (roll < 0.6) {
                // 20% SALTAR
                pet.classList.add('jumping');
            } else if (roll < 0.7) {
                // 10% GIRAR DE ALEGR√çA
                pet.classList.add('spinning');
                showEmote('‚ú®');
            } else {
                // 30% QUIETO (IDLE)
                // Solo respira
            }
        }

        function petInteract() {
            petAI.moving = false; // Pausar IA
            const pet = document.getElementById('pet-container');
            
            // Frenar movimiento
            const computed = window.getComputedStyle(pet);
            pet.style.left = computed.left;
            pet.style.transition = "none";
            
            // Animaci√≥n
            pet.classList.remove('jumping', 'spinning');
            void pet.offsetWidth; // reset
            pet.classList.add('double-jumping');
            showEmote('‚ù§Ô∏è');
        }

        function petResume() {
            petAI.moving = true; // Reanudar IA
        }

        function showEmote(emoji) {
            const b = document.getElementById('emote-bubble');
            b.innerText = emoji; b.classList.add('emote-visible');
            setTimeout(()=>b.classList.remove('emote-visible'), 1500);
        }

        // --- TIMER & ENV ---
        function toggleTimer() {
            if(timer.interval) { clearInterval(timer.interval); timer.interval=null; document.getElementById('btn-action').innerText="Reanudar"; }
            else { document.getElementById('btn-action').innerText="Pausar"; timer.interval = setInterval(tick, 1000); }
        }
        
        function tick() {
            timer.left--;
            updateVisuals();
            if(timer.left <= 0) finish();
        }

        function updateVisuals() {
            let t = timer.left < 0 ? 0 : timer.left;
            const m = Math.floor(t/60).toString().padStart(2,'0');
            const s = (t%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${m}:${s}`;
            
            const prog = 1 - (t / timer.total);
            
            // Tree
            const idx = Math.min(Math.floor(prog*treeStages.length), treeStages.length-1);
            const tree = document.getElementById('tree-display');
            tree.innerText = treeStages[idx];
            tree.style.transform = `translateX(-50%) scale(${1 + prog*0.6})`;

            // Atmosfera simplificada
            const bg = document.getElementById('garden-bg');
            if(prog < 0.3) bg.style.background = "linear-gradient(to top, #81d4fa, #4fc3f7)"; // Dia
            else if(prog < 0.7) { bg.style.background = "linear-gradient(to top, #ffcc80, #ffab91)"; // Tarde
                document.getElementById('rain').style.opacity = (prog>0.45 && prog<0.55) ? 0.6 : 0; }
            else { bg.style.background = "linear-gradient(to top, #1a237e, #000051)"; // Noche
                document.getElementById('stars').style.opacity = 1; }
        }

        function finish() {
            clearInterval(timer.interval); clearInterval(petAI.interval);
            document.getElementById('reward-area').classList.remove('hidden');
        }

        // --- EXTRAS ---
        function toggleOverlay(id) { document.getElementById(id+'-overlay').classList.toggle('hidden'); }
        function devAdd(s) { timer.left -= s; updateVisuals(); if(timer.left<=0) finish(); }
        
        // Kanban Mockup
        function addTask() { 
            const val = document.getElementById('task-input').value; 
            if(val) { 
                const d = document.createElement('div'); d.className='task-card'; d.innerText=val; 
                d.onclick=function(){this.remove()}; // Simple remove for demo
                document.getElementById('col-todo').appendChild(d);
                document.getElementById('task-input').value="";
            }
        }
        function updateKanban() {} // Placeholder

        function renderCollection() {
            const c = document.getElementById('collection-list'); c.innerHTML="";
            jpWords.forEach(w => {
                const d = document.createElement('div'); d.className='word-card';
                d.innerHTML = `<b style="color:#FFB7B2; display:block; font-size:1.2rem">${w.jp}</b><span style="font-size:0.8rem; color:#777">${w.es}</span>`;
                c.appendChild(d);
            });
        }
    </script>
</body>
</html>
